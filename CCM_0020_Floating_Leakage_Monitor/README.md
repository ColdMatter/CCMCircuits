# CCM_0020 50kV Floating pA Leakage Current Monitor
     
This is a circuit used to monitor pA-level leakage currents on the HV plates of 
the ultracold edm experiment.  We have a design goal of having the leakage currents be less than 25 pA.  To make sure this is the case, we want to be able to measure currents at the pA level.  This is hard.  Floating the entire circuit up to a few tens of kV makes it even harder.  This is my kind of problem -NF.    

## Design Resources
- Bob Pease: What's all this teflon stuff anyhow?
- Bob Pease: What's all this femtoampere stuff anyhow?
- Keithley low-level measurement handbook
- LM662 datasheet
- Analog Devices ADA4530-1 datasheet: https://www.analog.com/media/en/technical-documentation/data-sheets/ADA4530-1.pdf 
- Analog Devices ADA4530-1 demo board user's guide: https://www.analog.com/media/en/technical-documentation/user-guides/ADA4530-1R-EBZ_UG-865.pdf


## Design Notes
The transmitter section of the circuit features three critical design elements: 
ultra low input leakage currents, ultra low power consumption, and high voltage 
isolation.  The former is required of any circuit capable of measuring currents 
on the pA level.  The most sensitive way to measure extremely low currents (like the fA-level features by some of the op amps we'll be using here) is to integrate for many seconds and read off the voltage.  Of course, you need an integrating capacitor with low leakage too: a length of teflon coated coaxial wire is a good choice, you can even drive the coax outer conductor with a shielding potential ("self shielded") to avoid dielectric relaxation effects.  The small enclosed volume also lowers the sensitivity to cosmic rays, to which you are sensitive to at this level.  To monitor the leakage on the edm electric field plates, we need a time-resolved signal, so integrating is out.  We don't care at the fA level, so this shouldn't pose a problem.  A sense resistor + buffer amplifier (alternatively, a transimpedance amplifier) should be sensitive enough and give us real-time measurements. 

Achieving ultra low input leakage currents starts with choosing an appropriate 
operational amplifier, in this case in a voltage "buffer" configuration.  Luckily, there are a number of (CMOS) op amps on the market that feature input leakage currents on the order of 10 fA.  We have the additional challenge of needing an op amp that has low quiescent current requirements.  The LMP2231 made by Texas Instruments seems to fit the bill: 20 fA input leakage current (typical, 1 pA max) while only needing 10 uA of quiescent current.

Taking advantage of the ultra-low input current leakage specification of our chosen op amp requires a significant amount of layout/design work.  It won't do us any good to use such an op amp on a dirty FR4 board that will leak currents of many pA into our inputs every time the humidity changes.  The first line of defense is to use a low-leakage circuit board material.  A 4-layer board with outer layers made of Rogers 4350B (a ceramic) and the inner substrate made of FR408 (for strength) seems like a good way to go.  Beyond that, high-impedance circuit inputs are shielded at numerous levels.  The buffer op amp inputs use a "guard ring" driven by a low impedance source (the op amp output) held at the same voltage as the inputs themselves, which eliminates leakage from surrounding on-board potentials.  The guard ring is exposed copper so that no charge carriers can leak past on the soldermask or silkscreen layers.  The guard ring extends underneath the top ceramic layer to shield the input pins (from below) from the FR4 inner layer.  A via fence on the outer perimeter of the guard ring completes the board-level shielding.  Additional shielding is achieved by two layers of brass boxes, the inner one (top and bottom of the board) at the same potential as the guard ring and the outer one (again, on both top and bottom) at floating "ground".  A triax cable uses the same two shielding potentials to bring the HV line into the circuit.

Of all the challenges to overcome here, the HV isolation is perhaps the easiest to overcome.  Optek makes the OPI15X series of opto-couplers/isolators that are rated to 50 kV in air.  We could just do our usual trick: use a sense resistor and buffer amplifier to generate a voltage, convert that voltage to a frequency using a VtoF converter and optically transmit that frequency.  Optical transmission can either be done using a fiber (e.g. Agilent's HFBR-1520) or an Optek OPI155 optoisolator.  However, both of these require significant (many mA) led drive current in order to toggle the logic output on the receiver.  Instead, I'm planning to use the OPI150 optocoupler (transmitting LED + receiving phototransistor) with the phototransistor receiver wired as a photodiode (base shorted to emitter) and the generated photocurrent being detected by a high-gain transimpedance amplifier.  In principle, this should allow us to get the signal out using much less power.  The output of the transimpedance could even feed into a precisely tuned comparator to give high sensitivity and logic-level outputs.  We could even transmit an analog signal instead of a digital one using the same setup but without the receiver comparator.  I think the digital approach will have better noise immunity, larger dynamic range, and potentially uses less power.  That means we'll likely have to do VtoF after all.  Even though you can't buy low power VtoF ICs (or VCOs), you can build your own.  The LTC1541 [op amp + comparator + voltage reference] has one option in the applications section of its datasheet.  You can build a 0-10 kHz VtoF with quiescent current requirements around 5 uA, some 200 x less than the lowest power monolithic solution.  

Along with the problem of high-voltage isolation comes the question of how to power the isolated transmitter section of the circuit.  The most obvious answer is to use batteries, but in practice that turns out to be relatively annoying.  An alternative is to power the circuit using some high-power leds and a solar panel on the transmitter.  This sounds elegant, and I think it probably could be if the transmitter was designed for very low-power operation, but in practice it makes the current monitors very big (and bright -- you need lots of optical power).  I've decided to try something crazy: design for ultra-low power on the transmitter and power it via photocurrent generated from (many of)
the same model of optocoupler that we're using to get the signal out.  With a max allowed LED current of 50 mA and a transfer ratio of ~2000:1, with six optocouplers I think I should be able to create a 2.5 V, 50 uA power supply on the transmitter circuit.  With a careful design I think that should be enough. 


## Known Issues