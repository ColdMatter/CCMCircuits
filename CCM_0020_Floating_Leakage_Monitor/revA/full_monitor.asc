Version 4
SHEET 1 2324 680
WIRE 144 -560 112 -560
WIRE 240 -560 224 -560
WIRE -16 -448 -64 -448
WIRE 112 -448 112 -560
WIRE 112 -448 48 -448
WIRE 144 -448 112 -448
WIRE 240 -448 240 -560
WIRE 240 -448 208 -448
WIRE 272 -448 240 -448
WIRE 384 -448 352 -448
WIRE 416 -448 384 -448
WIRE 560 -448 496 -448
WIRE -608 -400 -608 -480
WIRE 560 -400 560 -448
WIRE -448 -384 -560 -384
WIRE 384 -288 384 -448
WIRE 384 -288 144 -288
WIRE -448 -272 -448 -384
WIRE -288 -272 -448 -272
WIRE -224 -272 -288 -272
WIRE -176 -272 -224 -272
WIRE -64 -272 -64 -448
WIRE -64 -272 -96 -272
WIRE 80 -272 -64 -272
WIRE 160 -256 144 -256
WIRE 256 -256 240 -256
WIRE 288 -256 256 -256
WIRE 416 -256 368 -256
WIRE -224 -240 -224 -272
WIRE 256 -224 256 -256
WIRE -2016 -208 -2240 -208
WIRE -1728 -208 -2016 -208
WIRE -1488 -208 -1728 -208
WIRE 112 -192 112 -240
WIRE -224 -160 -224 -176
WIRE 1584 -144 1312 -144
WIRE 1056 -128 992 -128
WIRE 1200 -128 1120 -128
WIRE 1312 -112 1312 -144
WIRE 592 -96 592 -160
WIRE -608 -80 -608 -304
WIRE -384 -80 -608 -80
WIRE -32 -64 -160 -64
WIRE 128 -64 48 -64
WIRE 160 -64 128 -64
WIRE 288 -64 288 -256
WIRE 288 -64 240 -64
WIRE -1072 -32 -1312 -32
WIRE -288 -32 -288 -272
WIRE 992 -32 992 -128
WIRE 1072 -32 992 -32
WIRE 1200 -32 1200 -128
WIRE 1200 -32 1152 -32
WIRE 1840 -32 1808 -32
WIRE 2000 -32 1920 -32
WIRE 128 -16 128 -64
WIRE -1728 0 -1728 -208
WIRE -1728 0 -1824 0
WIRE -1680 0 -1728 0
WIRE -1584 0 -1680 0
WIRE 1312 0 1312 -32
WIRE 1360 0 1312 0
WIRE -880 16 -912 16
WIRE -736 16 -800 16
WIRE -608 16 -656 16
WIRE -464 16 -608 16
WIRE -352 16 -464 16
WIRE 1312 16 1312 0
WIRE -128 32 -224 32
WIRE -608 48 -608 16
WIRE -352 48 -368 48
WIRE -1824 64 -1824 0
WIRE -2544 80 -2544 32
WIRE -1680 80 -1680 0
WIRE -1584 80 -1584 0
WIRE -384 80 -384 -80
WIRE -352 80 -384 80
WIRE 592 80 592 -16
WIRE 640 80 592 80
WIRE 992 80 992 -32
WIRE 992 80 832 80
WIRE -384 96 -384 80
WIRE -384 96 -400 96
WIRE 128 96 128 64
WIRE -1488 112 -1488 -208
WIRE -1344 112 -1488 112
WIRE -1216 112 -1216 80
WIRE -384 112 -384 96
WIRE -352 112 -384 112
WIRE -1312 128 -1312 -32
WIRE -1248 128 -1312 128
WIRE -464 128 -464 16
WIRE -464 128 -528 128
WIRE 1312 128 1312 96
WIRE 1440 128 1440 80
WIRE -2384 144 -2384 48
WIRE -1488 144 -1488 112
WIRE -1072 144 -1072 -32
WIRE -1072 144 -1184 144
WIRE -1040 144 -1072 144
WIRE -464 144 -464 128
WIRE 912 144 832 144
WIRE 1104 144 1104 96
WIRE 1360 144 1360 0
WIRE 1408 144 1360 144
WIRE -2016 160 -2016 -208
WIRE -1856 160 -1856 112
WIRE -1760 160 -1760 112
WIRE -1760 160 -1856 160
WIRE -1648 160 -1760 160
WIRE -1616 160 -1616 128
WIRE -1616 160 -1648 160
WIRE -1344 160 -1344 112
WIRE -1248 160 -1344 160
WIRE -608 160 -608 112
WIRE 224 160 -64 160
WIRE 992 160 992 80
WIRE 1072 160 992 160
WIRE 1520 160 1472 160
WIRE 1584 160 1584 -144
WIRE 1584 160 1520 160
WIRE 1808 160 1808 -32
WIRE 1808 160 1584 160
WIRE 1872 160 1872 112
WIRE -320 176 -320 160
WIRE -256 176 -256 160
WIRE -256 176 -320 176
WIRE 224 176 224 160
WIRE 640 176 592 176
WIRE 912 176 912 144
WIRE 912 176 832 176
WIRE 1200 176 1200 -32
WIRE 1200 176 1136 176
WIRE 1216 176 1200 176
WIRE 1296 176 1280 176
WIRE 1408 176 1296 176
WIRE 1808 176 1808 160
WIRE 1840 176 1808 176
WIRE -2544 192 -2544 160
WIRE -2544 192 -2608 192
WIRE -368 192 -368 48
WIRE -368 192 -416 192
WIRE -288 192 -368 192
WIRE -160 192 -160 -64
WIRE -160 192 -288 192
WIRE 1072 192 992 192
WIRE 2000 192 2000 -32
WIRE 2000 192 1904 192
WIRE 2080 192 2000 192
WIRE -2608 208 -2608 192
WIRE -368 208 -368 192
WIRE 1840 208 1808 208
WIRE -2544 224 -2544 192
WIRE -1648 224 -1648 160
WIRE -1216 224 -1216 176
WIRE -320 224 -320 176
WIRE 1296 224 1296 176
WIRE 1440 224 1440 192
WIRE -1856 240 -1856 160
WIRE -1760 240 -1760 160
WIRE -288 240 -288 192
WIRE -240 240 -288 240
WIRE -128 240 -128 32
WIRE -128 240 -176 240
WIRE -64 240 -64 160
WIRE -64 240 -128 240
WIRE 992 240 992 192
WIRE 1104 240 1104 208
WIRE -528 256 -528 128
WIRE 912 256 912 176
WIRE 912 256 864 256
WIRE 960 256 912 256
WIRE 592 272 592 176
WIRE 864 272 864 256
WIRE -2384 288 -2384 224
WIRE -368 288 -368 272
WIRE 96 288 96 256
WIRE 224 288 224 256
WIRE 224 288 144 288
WIRE 336 288 224 288
WIRE 960 288 960 256
WIRE -704 304 -736 304
WIRE -592 304 -624 304
WIRE -464 304 -464 208
WIRE -320 304 -464 304
WIRE -128 304 -128 240
WIRE -128 304 -256 304
WIRE 176 304 128 304
WIRE 224 304 224 288
WIRE 1520 304 1520 160
WIRE 1552 304 1520 304
WIRE 1648 304 1632 304
WIRE 1808 304 1808 208
WIRE 1808 304 1648 304
WIRE 1872 304 1872 224
WIRE 64 320 0 320
WIRE 336 320 336 288
WIRE -2544 336 -2544 304
WIRE 144 336 144 288
WIRE 144 336 128 336
WIRE 1296 336 1296 304
WIRE -1792 352 -1792 288
WIRE -1712 352 -1792 352
WIRE -1680 352 -1680 272
WIRE -1680 352 -1712 352
WIRE -1584 352 -1584 272
WIRE -1584 352 -1680 352
WIRE -128 368 -128 304
WIRE -416 384 -416 192
WIRE -368 384 -416 384
WIRE 864 384 864 352
WIRE 912 384 864 384
WIRE 960 384 960 352
WIRE 960 384 912 384
WIRE 1648 384 1648 304
WIRE -464 400 -464 304
WIRE 176 400 176 304
WIRE 224 400 224 368
WIRE 224 400 176 400
WIRE 288 400 288 -64
WIRE 288 400 224 400
WIRE 912 416 912 384
WIRE 336 432 336 384
WIRE -368 480 -368 384
WIRE -528 496 -528 352
WIRE -464 496 -464 464
WIRE -464 496 -528 496
WIRE 1648 496 1648 448
WIRE -2016 528 -2016 256
WIRE -2016 528 -2240 528
WIRE -1840 528 -2016 528
WIRE -1712 528 -1712 352
WIRE -1712 528 -1840 528
WIRE -1488 528 -1488 224
WIRE -1488 528 -1712 528
WIRE -464 528 -464 496
WIRE -1840 592 -1840 528
WIRE -736 608 -736 304
WIRE -368 608 -368 544
WIRE -368 608 -736 608
WIRE 0 608 0 320
WIRE 0 608 -368 608
FLAG -608 160 0
FLAG -912 16 V_in
IOPIN -912 16 In
FLAG -464 528 0
FLAG -128 368 V_out
IOPIN -128 368 Out
FLAG -368 288 0
FLAG 336 432 0
FLAG -400 96 V_ref
IOPIN -400 96 Out
FLAG 256 -224 V_ref
IOPIN 256 -224 In
FLAG -2544 32 +5V
IOPIN -2544 32 Out
FLAG 112 -192 0
FLAG 112 -304 +5V
IOPIN 112 -304 In
FLAG 96 352 +5V
IOPIN 96 352 In
FLAG 416 -256 +5V
IOPIN 416 -256 In
FLAG 96 256 0
FLAG 560 -400 0
FLAG -224 -160 0
FLAG 128 96 0
FLAG -320 224 0
FLAG -608 -480 +5V
IOPIN -608 -480 In
FLAG 592 -160 +5V
IOPIN 592 -160 In
FLAG 592 272 V_out
IOPIN 592 272 In
FLAG 1104 96 +5V
IOPIN 1104 96 In
FLAG 992 240 0
FLAG 1440 80 +5V
IOPIN 1440 80 In
FLAG 1312 128 0
FLAG 1872 304 +5V
IOPIN 1872 304 In
FLAG 1648 496 0
FLAG 1104 240 0
FLAG 1872 112 0
FLAG 1440 224 0
FLAG -2608 208 0
FLAG -2544 336 -5V
IOPIN -2544 336 Out
FLAG 912 416 -5V
IOPIN 912 416 In
FLAG 1296 336 0
FLAG -2240 -208 I-in1
IOPIN -2240 -208 In
FLAG -2240 528 I-in2
IOPIN -2240 528 In
FLAG -2384 48 I-in1
IOPIN -2384 48 Out
FLAG -2384 288 I-in2
IOPIN -2384 288 Out
FLAG -1040 144 V_in
IOPIN -1040 144 Out
FLAG -1216 80 +5V
IOPIN -1216 80 In
FLAG -1216 224 0
FLAG -1840 592 0
FLAG 2080 192 f_out
IOPIN 2080 192 Out
SYMBOL Opamps\\LT1495 96 384 R180
SYMATTR InstName U4
SYMBOL Comparators\\LTC1440 -288 -32 R0
SYMATTR InstName U1
SYMBOL res -640 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 100k
SYMBOL res -784 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 562k
SYMBOL cap -624 48 R0
SYMATTR InstName C1
SYMATTR Value 8.2n
SYMBOL schottky -480 144 R0
SYMATTR InstName D1
SYMBOL schottky -480 400 R0
SYMATTR InstName D2
SYMBOL res -608 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 15k
SYMBOL npn -592 256 R0
SYMATTR InstName Q1
SYMBOL cap -256 288 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL cap -176 224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 12p
SYMBOL schottky -352 272 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode -352 544 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL res 240 272 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R4
SYMATTR Value 10Meg
SYMBOL diode 208 304 R0
SYMATTR InstName D5
SYMBOL cap 320 320 R0
SYMATTR InstName C4
SYMATTR Value 50n
SYMBOL Opamps\\LT1495 112 -336 M0
SYMATTR InstName U2
SYMBOL res 384 -272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 20Meg
SYMBOL res 256 -272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 3.9Meg
SYMBOL voltage -2544 64 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL schottky -16 -432 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D6
SYMBOL schottky 144 -432 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D7
SYMBOL res 368 -464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10Meg
SYMBOL res 512 -464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 3.9Meg
SYMBOL res 240 -576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 270k
SYMBOL res -80 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 390
SYMBOL cap -240 -240 R0
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL res 112 -32 R0
SYMATTR InstName R11
SYMATTR Value 39k
SYMBOL res 64 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 360k
SYMBOL res 256 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 3.6Meg
SYMBOL pmos -560 -304 R180
SYMATTR InstName M1
SYMBOL Optos\\4N25 736 144 R0
SYMATTR InstName U3
SYMBOL res 576 -112 R0
SYMATTR InstName R14
SYMATTR Value 40k
SYMBOL res 1168 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 100Meg
SYMBOL res 1296 -128 R0
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL res 1296 0 R0
SYMATTR InstName R18
SYMATTR Value 200
SYMBOL cap 1120 -144 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value 5p
SYMBOL Comparators\\LT1017 1872 192 M180
SYMATTR InstName U5
SYMBOL res 1936 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 67k
SYMBOL res 1648 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL cap 1632 384 R0
SYMATTR InstName C8
SYMATTR Value 47n
SYMBOL Opamps\\AD822 1104 112 R0
SYMATTR InstName U6
SYMBOL Opamps\\AD822 1440 96 R0
SYMATTR InstName U7
SYMBOL voltage -2544 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL res 848 256 R0
SYMATTR InstName R15
SYMATTR Value 3.3Meg
SYMBOL cap 944 288 R0
SYMATTR InstName C9
SYMATTR Value 10p
SYMBOL res 1280 208 R0
SYMATTR InstName R21
SYMATTR Value 100k
SYMBOL cap 1280 160 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 1µ
SYMBOL Misc\\neonbulb -2016 208 R0
SYMATTR InstName U8
SYMBOL njf -1760 64 R90
SYMATTR InstName J1
SYMBOL njf -1856 288 R270
SYMATTR InstName J3
SYMBOL njf -1584 224 R90
SYMATTR InstName J4
SYMBOL njf -1680 128 R270
SYMATTR InstName J5
SYMBOL res -1504 128 R0
SYMATTR InstName R_sense
SYMATTR Value 1G
SYMBOL Opamps\\LT1001 -1216 80 R0
SYMATTR InstName U9
SYMBOL current -2384 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value 1n
TEXT -1304 616 Left 2 !.tran 0 0.3 0.298 startup
